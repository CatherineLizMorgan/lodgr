// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model for hosts and guests
model User {
  id                String   @id @default(uuid())
  email             String   @unique
  password          String
  firstName         String
  lastName          String
  phone             String?
  isVerified        Boolean  @default(false)
  isHost            Boolean  @default(false)
  avatarUrl         String?
  bio               String?
  reputationScore   Float    @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  hostedListings    Listing[]   @relation("HostListings")
  bookings          Booking[]   @relation("GuestBookings")
  reviews           Review[]    @relation("ReviewsWritten")
  receivedReviews   Review[]    @relation("ReviewsReceived")

  @@map("users")
}

// Accommodation listing model
model Listing {
  id                String   @id @default(uuid())
  hostId            String
  title             String
  description       String
  accommodationType String   // 'couch', 'shared', 'private', 'entire'
  pricePerNight     Float
  maxGuests         Int
  address           String
  city              String
  country           String
  latitude          Float
  longitude         Float
  amenities         String[] // Array of amenities
  images            String[] // Array of image URLs
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  host              User      @relation("HostListings", fields: [hostId], references: [id], onDelete: Cascade)
  bookings          Booking[]
  eventListings     EventListing[]

  @@map("listings")
}

// Event model for major events
model Event {
  id                String   @id @default(uuid())
  name              String
  eventType         String   // 'world_cup', 'olympics', 'f1', 'concert', 'convention'
  startDate         DateTime
  endDate           DateTime
  city              String
  country           String
  venueLatitude     Float
  venueLogitude     Float
  venueName         String
  description       String?
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  eventListings     EventListing[]

  @@map("events")
}

// Junction table for events and listings
model EventListing {
  id                String   @id @default(uuid())
  eventId           String
  listingId         String
  distanceToVenue   Float    // in kilometers
  createdAt         DateTime @default(now())

  // Relations
  event             Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  listing           Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@unique([eventId, listingId])
  @@map("event_listings")
}

// Booking model
model Booking {
  id                String   @id @default(uuid())
  listingId         String
  guestId           String
  checkIn           DateTime
  checkOut          DateTime
  numberOfGuests    Int
  totalPrice        Float
  status            String   @default("pending") // 'pending', 'confirmed', 'cancelled', 'completed'
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  listing           Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  guest             User     @relation("GuestBookings", fields: [guestId], references: [id], onDelete: Cascade)
  payment           Payment?

  @@map("bookings")
}

// Payment model
model Payment {
  id                String   @id @default(uuid())
  bookingId         String   @unique
  amount            Float
  currency          String   @default("USD")
  paymentMethod     String
  paymentStatus     String   @default("pending") // 'pending', 'completed', 'failed', 'refunded'
  stripePaymentId   String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  booking           Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@map("payments")
}

// Review model
model Review {
  id                String   @id @default(uuid())
  authorId          String
  recipientId       String
  rating            Int      // 1-5 stars
  comment           String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  author            User     @relation("ReviewsWritten", fields: [authorId], references: [id], onDelete: Cascade)
  recipient         User     @relation("ReviewsReceived", fields: [recipientId], references: [id], onDelete: Cascade)

  @@map("reviews")
}
